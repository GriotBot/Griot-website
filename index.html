<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GriotBot Chat</title>
  <style>
    /*---------------------------------------
      1. THEME VARIABLES
    ---------------------------------------*/
    :root {
      /* Light theme */
      --bg-color: #f6f1ec;
      --text-color: #4b2e2a;
      --header-bg: #c49a6c;
      --sidebar-bg: rgba(75, 46, 42, 0.85);
      --user-bubble: #bd8735;
      --bot-bubble-start: #7d8765;
      --bot-bubble-end: #5e6e4f;
    }
    [data-theme="dark"] {
      /* Dark theme overrides */
      --bg-color: #2e2a24;
      --text-color: #e6e2d9;
      --header-bg: #533f33;
      --sidebar-bg: rgba(30, 25, 20, 0.85);
      --user-bubble: #a6754c;
      --bot-bubble-start: #5e6e4f;
      --bot-bubble-end: #3e4a38;
    }

    /*---------------------------------------
      2. GLOBAL STYLES
    ---------------------------------------*/
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Helvetica, Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }
    button { background: none; border: none; cursor: pointer; }

    /*---------------------------------------
      3. HEADER + NAV
    ---------------------------------------*/
    #header {
      position: relative;
      background-color: var(--header-bg);
      color: white;
      padding: 1rem;
      text-align: center;
      font-weight: bold;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
    }
    #toggleSidebar {
      position: absolute;
      left: 1rem;
      font-size: 1.5rem;
    }
    #toggleSidebar[aria-expanded="true"] {
      transform: rotate(45deg);
    }
    #themeToggle {
      position: absolute;
      right: 1rem;
      font-size: 1.5rem;
    }

    /*---------------------------------------
      4. SIDEBAR
    ---------------------------------------*/
    #sidebar {
      position: fixed;
      top: 0; left: 0;
      height: 100%;
      width: 220px;
      background: var(--sidebar-bg);
      color: white;
      padding: 1rem;
      transform: translateX(-100%);
      transition: transform 0.3s ease-in-out;
      backdrop-filter: blur(12px);
      box-shadow: 4px 0 20px rgba(0,0,0,0.4);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    #sidebar.visible {
      transform: translateX(0);
    }
    #sidebar h2 {
      margin: 0;
    }
    #sidebar a {
      color: white;
      text-decoration: none;
    }

    /*---------------------------------------
      5. CHAT AREA
    ---------------------------------------*/
    #chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow-y: auto;
      padding: 1rem;
      padding-bottom: 200px;
      scroll-behavior: smooth;
    }
    #logo {
      font-size: 4rem;
      margin-bottom: 0.5rem;
    }
    #quote {
      font-size: 1rem;
      font-style: italic;
      color: var(--bot-bubble-start);
      text-align: center;
      margin-bottom: 2rem;
    }
    #chat {
      width: 100%;
      max-width: 700px;
      display: flex;
      flex-direction: column;
    }

    /*---------------------------------------
      6. MESSAGE BUBBLES
    ---------------------------------------*/
    .message {
      padding: 0.5rem;
      margin: 0.5rem 0;
      border-radius: 12px;
      max-width: 65%;
      word-wrap: break-word;
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
      transition: transform 0.2s ease;
    }
    .user {
      align-self: flex-end;
      background-color: var(--user-bubble);
    }
    .user:hover { transform: translateY(-2px); }
    .bot {
      align-self: flex-start;
      background: linear-gradient(135deg, var(--bot-bubble-start), var(--bot-bubble-end));
    }
    .bot:hover { transform: translateY(-2px); }

    /*---------------------------------------
      7. INPUT FORM
    ---------------------------------------*/
    #form {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 700px;
      display: flex;
      border-top: 1px solid var(--header-bg);
      background: var(--bg-color);
      padding: 0.5rem;
    }
    #input {
      flex: 1;
      padding: 0.5rem;
      border: 1px solid var(--header-bg);
      border-radius: 8px 0 0 8px;
      outline: none;
      transition: border 0.3s, box-shadow 0.3s;
    }
    #input:focus {
      border-color: var(--bot-bubble-start);
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
    }
    #send {
      padding: 0 1rem;
      background: var(--header-bg);
      color: white;
      border-radius: 0 8px 8px 0;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    #send:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      background: var(--bot-bubble-start);
    }

    /*---------------------------------------
      8. PROVERB & COPYRIGHT
    ---------------------------------------*/
    #fact {
      position: fixed;
      bottom: 50px;
      width: 100%;
      text-align: center;
      font-size: 0.9rem;
      font-style: italic;
      padding: 0 1rem;
      color: var(--text-color);
    }
    #copyright {
      position: fixed;
      bottom: 20px;
      width: 100%;
      text-align: center;
      font-size: 0.8rem;
      color: var(--bot-bubble-start);
    }

    /*---------------------------------------
      9. RESPONSIVE TWEAKS
    ---------------------------------------*/
    @media (max-width: 600px) {
      #form { bottom: 20px; }
      .message { max-width: 90%; }
    }
  </style>
</head>
<body>
  <!-- HEADER + CONTROLS -->
  <div id="header">
    <button id="toggleSidebar" aria-label="Toggle sidebar" aria-expanded="false">‚ò∞</button>
    GriotBot
    <button id="themeToggle" aria-label="Toggle dark/light mode">üåó</button>
  </div>

  <!-- SIDEBAR -->
  <nav id="sidebar" aria-hidden="true">
    <h2>GriotBot</h2>
    <button onclick="location.reload()">New Chat</button>
    <a href="about.html">About GriotBot</a>
    <a href="feedback.html">Share Feedback</a>
  </nav>

  <!-- MAIN CHAT AREA -->
  <main id="chat-container">
    <div id="logo">üåø</div>
    <div id="quote">
      "A people without the knowledge of their past history,<br>
      origin and culture is like a tree without roots." <br>
      ‚Äî¬†Marcus Mosiah¬†Garvey
    </div>
    <div id="chat"></div>
  </main>

  <!-- MESSAGE INPUT -->
  <form id="form">
    <input id="input" type="text" placeholder="Ask GriotBot‚Ä¶" required />
    <button id="send" type="submit">Send</button>
  </form>

  <!-- RANDOM PROVERB & COPYRIGHT -->
  <div id="fact"></div>
  <div id="copyright">¬©¬†2025¬†GriotBot. All rights reserved.</div>

  <script>
    //‚Äì‚Äì SANITIZER TO PREVENT XSS ‚Äì‚Äì
    function sanitize(text) {
      const d = document.createElement('div');
      d.textContent = text;
      return d.innerHTML;
    }

    //‚Äì‚Äì ELEMENT REFERENCES ‚Äì‚Äì
    const sidebar      = document.getElementById('sidebar');
    const toggleBtn    = document.getElementById('toggleSidebar');
    const themeToggle  = document.getElementById('themeToggle');
    const chatContainer= document.getElementById('chat-container');
    const chat         = document.getElementById('chat');
    const form         = document.getElementById('form');
    const input        = document.getElementById('input');
    const factElement  = document.getElementById('fact');

    //‚Äì‚Äì 1. SIDEBAR TOGGLE ‚Äì‚Äì
    toggleBtn.addEventListener('click', () => {
      const visible = sidebar.classList.toggle('visible');
      toggleBtn.setAttribute('aria-expanded', visible);
      sidebar.setAttribute('aria-hidden', !visible);
    });
    chatContainer.addEventListener('click', () => {
      sidebar.classList.remove('visible');
      toggleBtn.setAttribute('aria-expanded','false');
      sidebar.setAttribute('aria-hidden','true');
    });

    //‚Äì‚Äì 2. THEME TOGGLE ‚Äì‚Äì
    (function() {
      const saved = localStorage.getItem('griotbot-theme') || 'light';
      document.documentElement.setAttribute('data-theme', saved);
      themeToggle.textContent = saved === 'dark' ? '‚òÄÔ∏è' : 'üåó';
    })();
    themeToggle.addEventListener('click', () => {
      const cur = document.documentElement.getAttribute('data-theme');
      const next = cur === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('griotbot-theme', next);
      themeToggle.textContent = next === 'dark' ? '‚òÄÔ∏è' : 'üåó';
    });

    //‚Äì‚Äì 3. RANDOM PROVERB ‚Äì‚Äì
    const facts = [
      "Wisdom is like a baobab tree; no one individual can embrace it. ‚Äî African Proverb",
      "Until the lion learns to write, every story will glorify the hunter. ‚Äî African Proverb",
      "We are the drums, we are the dance. ‚Äî Afro-Caribbean Proverb",
      "A tree cannot stand without its roots. ‚Äî Jamaican Proverb",
      "Unity is strength. ‚Äî Ghanaian Proverb",
      "Knowledge is power, but wisdom is peace. ‚Äî African Proverb",
      "Truth is like a drum, it can be heard from afar. ‚Äî African Proverb",
      "A bird will always use another bird‚Äôs feathers to feather its nest. ‚Äî Kenyan Proverb",
      "You must act as if it is impossible to fail. ‚Äî African Proverb",
      "The child who is not embraced by the village will burn it down to feel its warmth. ‚Äî African Proverb"
    ];
    function showRandomProverb() {
      factElement.textContent = facts[Math.floor(Math.random() * facts.length)];
    }
    window.addEventListener('load', showRandomProverb);

    //‚Äì‚Äì 4. CHAT HISTORY (localStorage) ‚Äì‚Äì
    function loadChatHistory() {
      const hist = JSON.parse(localStorage.getItem('griotbot-history')||'[]');
      hist.forEach(m => appendMessage(m.role, m.content, false));
    }
    function saveChatHistory() {
      const msgs = Array.from(chat.querySelectorAll('.message'))
        .map(el => ({ role: el.classList.contains('user')? 'user':'bot', content: el.textContent }));
      localStorage.setItem('griotbot-history', JSON.stringify(msgs));
    }
    window.addEventListener('load', loadChatHistory);

    //‚Äì‚Äì 5. APPEND MESSAGE & AUTO‚ÄëSCROLL ‚Äì‚Äì
    function appendMessage(role, text, save=true) {
      const msg = document.createElement('div');
      msg.className = `message ${role}`;
      msg.innerHTML = sanitize(text);
      chat.appendChild(msg);
      chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
      if (save) saveChatHistory();
    }

    //‚Äì‚Äì 6. SEND MESSAGE HANDLER ‚Äì‚Äì
    form.addEventListener('submit', async e => {
      e.preventDefault();
      const userInput = input.value.trim();
      if (!userInput) return;
      // Disable while sending
      input.disabled = true;
      const sendBtn = document.getElementById('send');
      sendBtn.disabled = true;

      // Hide intro
      document.getElementById('logo').style.display = 'none';
      document.getElementById('quote').style.display = 'none';

      appendMessage('user', userInput);
      input.value = '';

      // Placeholder while waiting
      const botMsg = document.createElement('div');
      botMsg.className = 'message bot';
      botMsg.textContent = 'GriotBot is thinking‚Ä¶';
      chat.appendChild(botMsg);
      chatContainer.scrollTo({ top: chatContainer.scrollHeight });

      try {
        // CALL YOUR SERVERLESS PROXY ENDPOINT
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ prompt: userInput })
        });
        if (!res.ok) throw new Error(`Status ${res.status}`);
        const data = await res.json();
        botMsg.textContent = data.choices?.[0]?.message?.content || 'GriotBot is silent for now‚Ä¶';
      } catch (err) {
        botMsg.textContent = `Error: ${err.message}`;
        console.error('Detailed error:', err);
      } finally {
        // Re-enable
        input.disabled = false;
        sendBtn.disabled = false;
        input.focus();
        saveChatHistory();
      }
    });
  </script>
</body>
</html>
